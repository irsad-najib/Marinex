<Window x:Class="Marinex.Views.DashboardView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:gmap="clr-namespace:GMap.NET.WindowsPresentation;assembly=GMap.NET.WindowsPresentation"
        mc:Ignorable="d"
        Title="Marinex - Live Ship Tracking Dashboard" 
        Height="800" Width="1400"
        WindowState="Maximized"
        Background="#1E1E2E"
        FontFamily="Segoe UI">
    
    <Window.Resources>
        <!-- COLOR PALETTE (Cyberpunk Minimalist) -->
        <SolidColorBrush x:Key="BgDark" Color="#1E1E2E"/>      <!-- Deep Dark Blue -->
        <SolidColorBrush x:Key="BgCard" Color="#252535"/>      <!-- Lighter Panel Background -->
        <SolidColorBrush x:Key="AccentColor" Color="#89B4FA"/> <!-- Soft Electric Blue -->
        <SolidColorBrush x:Key="AccentHover" Color="#B4BEFE"/> <!-- Lighter Blue for Hover -->
        <SolidColorBrush x:Key="TextPrimary" Color="#CDD6F4"/> <!-- Off-White Text -->
        <SolidColorBrush x:Key="TextSecondary" Color="#A6ADC8"/> <!-- Muted Grey Text -->
        <SolidColorBrush x:Key="SuccessColor" Color="#A6E3A1"/> <!-- Green -->
        <SolidColorBrush x:Key="WarningColor" Color="#FAB387"/> <!-- Orange -->
        <SolidColorBrush x:Key="DangerColor" Color="#F38BA8"/>  <!-- Red -->

        <DropShadowEffect x:Key="CardShadow" BlurRadius="15" ShadowDepth="2" Opacity="0.2" Color="Black"/>

        <!-- STYLE: MENU BUTTONS (Sidebar) -->
        <Style x:Key="MenuButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextSecondary}"/>
            <Setter Property="FontSize" Value="14"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Height" Value="50"/>
            <Setter Property="Margin" Value="0,0,0,10"/>
            <Setter Property="HorizontalContentAlignment" Value="Left"/>
            <Setter Property="Padding" Value="20,0"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="10">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="Auto"/>
                                    <ColumnDefinition Width="*"/>
                                </Grid.ColumnDefinitions>
                                <!-- Content Presenter for Icon/Text -->
                                <ContentPresenter Grid.ColumnSpan="2" 
                                                VerticalAlignment="Center" 
                                                Margin="{TemplateBinding Padding}"/>
                                
                                <!-- Active Indicator (Hidden by default) -->
                                <Border x:Name="Indicator" 
                                        Grid.Column="0"
                                        HorizontalAlignment="Left"
                                        Width="4" Height="25" 
                                        CornerRadius="2"
                                        Background="{StaticResource AccentColor}"
                                        Visibility="Collapsed"
                                        Margin="0"/>
                            </Grid>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#313244"/>
                                <Setter Property="Foreground" Value="White"/>
                                <Setter TargetName="Indicator" Property="Visibility" Value="Visible"/>
                            </Trigger>
                            <Trigger Property="IsPressed" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#45475A"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- STYLE: ACTION BUTTONS (Small, Rounded) -->
        <Style x:Key="ActionButtonStyle" TargetType="Button">
            <Setter Property="Background" Value="{StaticResource BgCard}"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Padding" Value="12,8"/>
            <Setter Property="FontSize" Value="13"/>
            <Setter Property="FontWeight" Value="SemiBold"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="Button">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="8">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" Margin="{TemplateBinding Padding}"/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#313244"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

        <!-- STYLE: STAT CARDS (Top Dashboard) -->
        <Style x:Key="StatCardStyle" TargetType="Border">
            <Setter Property="Background" Value="{StaticResource BgCard}"/>
            <Setter Property="CornerRadius" Value="15"/>
            <Setter Property="Margin" Value="0,0,15,0"/>
            <Setter Property="Padding" Value="20"/>
            <Setter Property="Effect" Value="{StaticResource CardShadow}"/>
        </Style>

        <!-- STYLE: LISTBOX ITEM (Ship List) -->
        <Style x:Key="ShipListItem" TargetType="ListBoxItem">
            <Setter Property="Background" Value="Transparent"/>
            <Setter Property="Foreground" Value="{StaticResource TextPrimary}"/>
            <Setter Property="Padding" Value="15,12"/>
            <Setter Property="Margin" Value="0,0,0,5"/>
            <Setter Property="BorderThickness" Value="0"/>
            <Setter Property="Cursor" Value="Hand"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="ListBoxItem">
                        <Border x:Name="border" 
                                Background="{TemplateBinding Background}" 
                                CornerRadius="10"
                                Padding="{TemplateBinding Padding}">
                            <ContentPresenter/>
                        </Border>
                        <ControlTemplate.Triggers>
                            <Trigger Property="IsMouseOver" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#313244"/>
                            </Trigger>
                            <Trigger Property="IsSelected" Value="True">
                                <Setter TargetName="border" Property="Background" Value="#45475A"/>
                                <Setter TargetName="border" Property="BorderBrush" Value="{StaticResource AccentColor}"/>
                                <Setter TargetName="border" Property="BorderThickness" Value="1"/>
                            </Trigger>
                        </ControlTemplate.Triggers>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
        </Style>

    </Window.Resources>

    <Grid>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="260"/> <!-- Sidebar -->
            <ColumnDefinition Width="*"/>   <!-- Main Content -->
        </Grid.ColumnDefinitions>

        <!-- === SIDEBAR NAVIGATION === -->
        <Border Grid.Column="0" Background="{StaticResource BgCard}" BorderBrush="#313244" BorderThickness="0,0,1,0">
            <Grid>
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/> <!-- Logo -->
                    <RowDefinition Height="*"/>    <!-- Menu -->
                    <RowDefinition Height="Auto"/> <!-- User/Bottom -->
                </Grid.RowDefinitions>

                <!-- Logo -->
                <StackPanel Grid.Row="0" Orientation="Horizontal" Margin="25,35,20,40">
                    <TextBlock Text="âš“" FontSize="28" Foreground="{StaticResource AccentColor}" VerticalAlignment="Center"/>
                    <StackPanel Margin="12,0,0,0" VerticalAlignment="Center">
                        <TextBlock Text="MARINEX" FontSize="22" FontWeight="Bold" Foreground="White"/>
                        <TextBlock Text="Intelligence System" FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                    </StackPanel>
                </StackPanel>

                <!-- Menu Items -->
                <StackPanel Grid.Row="1" Margin="15,0">
                    <TextBlock Text="MAIN MENU" FontSize="11" FontWeight="Bold" Foreground="#585B70" Margin="10,0,0,10"/>
                    
                    <Button x:Name="btnCreateReport" Content="ðŸ“  Create Report" Style="{StaticResource MenuButtonStyle}" Click="btnCreateReport_Click"/>
                    <Button x:Name="btnViewReports" Content="ðŸ“Š  View All Reports" Style="{StaticResource MenuButtonStyle}" Click="btnViewReports_Click"/>
                    <Button x:Name="btnCheckWeather" Content="ðŸŒ¦ï¸  Weather Forecast" Style="{StaticResource MenuButtonStyle}" Click="btnCheckWeather_Click"/>
                    <Button x:Name="btnRegisterShip" Content="ðŸš¢  Register Vessel" Style="{StaticResource MenuButtonStyle}" Click="btnRegisterShip_Click"/>
                    <Button x:Name="btnTogglePollution" Content="â˜¢ï¸  Pollution Heatmap" Style="{StaticResource MenuButtonStyle}" Click="btnTogglePollution_Click"/>
                </StackPanel>

                <!-- Bottom Actions -->
                <StackPanel Grid.Row="2" Margin="20,0,20,30">
                    <!-- Connection Status Indicator -->
                    <Border Background="#1E1E2E" CornerRadius="8" Padding="12" Margin="0,0,0,15">
                        <StackPanel Orientation="Horizontal">
                            <Ellipse Width="8" Height="8" Fill="{StaticResource SuccessColor}"/>
                            <TextBlock x:Name="ConnectionStatus" Text="System Online" FontSize="12" Foreground="{StaticResource SuccessColor}" Margin="10,0,0,0" FontWeight="SemiBold"/>
                        </StackPanel>
                    </Border>

                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"/>
                            <ColumnDefinition Width="10"/>
                            <ColumnDefinition Width="Auto"/>
                        </Grid.ColumnDefinitions>
                        
                        <Button x:Name="BtnToggleStream" 
                                Grid.Column="0"
                                Content="Stop Stream" 
                                Style="{StaticResource ActionButtonStyle}"
                                Background="#313244"
                                Foreground="{StaticResource TextPrimary}"
                                Click="BtnToggleStream_Click"/>

                        <Button x:Name="BtnLogout" 
                                Grid.Column="2"
                                Content="ðŸšª" 
                                ToolTip="Logout"
                                Style="{StaticResource ActionButtonStyle}"
                                Background="{StaticResource DangerColor}"
                                Foreground="#1E1E2E"
                                Padding="12,8"
                                Click="BtnLogout_Click"/>
                    </Grid>
                </StackPanel>
            </Grid>
        </Border>

        <!-- === MAIN CONTENT DASHBOARD === -->
        <Grid Grid.Column="1" Margin="30,30,30,20">
            <Grid.RowDefinitions>
                <RowDefinition Height="Auto"/> <!-- Stats Row -->
                <RowDefinition Height="*" x:Name="MapRow"/>   <!-- Map View -->
                <RowDefinition Height="300"/>  <!-- Ship List -->
            </Grid.RowDefinitions>

            <!-- 1. HEADER STATISTICS -->
            <Grid Grid.Row="0" Margin="0,0,0,25">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                    <ColumnDefinition Width="*"/>
                </Grid.ColumnDefinitions>

                <!-- Total Ships -->
                <Border Grid.Column="0" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="ðŸš¢" FontSize="16" Opacity="0.7"/>
                            <TextBlock Text="Total Vessels" FontSize="13" Foreground="{StaticResource TextSecondary}" Margin="8,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock x:Name="TxtTotalShips" Text="0" FontSize="32" FontWeight="Bold" Foreground="{StaticResource AccentColor}"/>
                    </StackPanel>
                </Border>

                <!-- Messages -->
                <Border Grid.Column="1" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="ðŸ“¡" FontSize="16" Opacity="0.7"/>
                            <TextBlock Text="AIS Messages" FontSize="13" Foreground="{StaticResource TextSecondary}" Margin="8,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock x:Name="TxtMessagesCount" Text="0" FontSize="32" FontWeight="Bold" Foreground="{StaticResource SuccessColor}"/>
                    </StackPanel>
                </Border>

                <!-- Active Connections -->
                <Border Grid.Column="2" Style="{StaticResource StatCardStyle}">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="ðŸ”—" FontSize="16" Opacity="0.7"/>
                            <TextBlock Text="Connections" FontSize="13" Foreground="{StaticResource TextSecondary}" Margin="8,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock x:Name="TxtActiveConnections" Text="0" FontSize="32" FontWeight="Bold" Foreground="{StaticResource WarningColor}"/>
                    </StackPanel>
                </Border>

                <!-- Last Update -->
                <Border Grid.Column="3" Style="{StaticResource StatCardStyle}" Margin="0">
                    <StackPanel>
                        <StackPanel Orientation="Horizontal" Margin="0,0,0,5">
                            <TextBlock Text="â±ï¸" FontSize="16" Opacity="0.7"/>
                            <TextBlock Text="Last Update" FontSize="13" Foreground="{StaticResource TextSecondary}" Margin="8,0,0,0" VerticalAlignment="Center"/>
                        </StackPanel>
                        <TextBlock x:Name="TxtLastUpdate" Text="--:--" FontSize="32" FontWeight="Bold" Foreground="{StaticResource DangerColor}"/>
                    </StackPanel>
                </Border>
            </Grid>

            <!-- 2. MAP AREA -->
            <Border x:Name="MapBorder" Grid.Row="1" CornerRadius="15" ClipToBounds="True" Background="{StaticResource BgCard}">
                <Grid>
                    <gmap:GMapControl x:Name="MainMap"/>
                    
                    <!-- Floating Map Controls -->
                    <StackPanel HorizontalAlignment="Right" VerticalAlignment="Top" Margin="20">
                        <Border Background="{StaticResource BgCard}" CornerRadius="10" Padding="5" Effect="{StaticResource CardShadow}">
                            <StackPanel>
                                <Button Content="âž•" ToolTip="Zoom In" Click="BtnZoomIn_Click" Style="{StaticResource ActionButtonStyle}" Width="35" Height="35" Padding="0" Margin="0,0,0,5"/>
                                <Button Content="âž–" ToolTip="Zoom Out" Click="BtnZoomOut_Click" Style="{StaticResource ActionButtonStyle}" Width="35" Height="35" Padding="0" Margin="0,0,0,5"/>
                                <Button Content="âŸ²" ToolTip="Reset View" Click="BtnResetView_Click" Style="{StaticResource ActionButtonStyle}" Width="35" Height="35" Padding="0"/>
                            </StackPanel>
                        </Border>
                        
                        <!-- Collapse Button -->
                        <Button x:Name="btnCollapseMap" 
                                Click="btnCollapseMap_Click"
                                Margin="0,15,0,0"
                                Height="35" Width="35"
                                Content="â–¼"
                                Style="{StaticResource ActionButtonStyle}"
                                Background="#313244"
                                ToolTip="Collapse Map"/>
                    </StackPanel>
                </Grid>
            </Border>

            <!-- Restore Map Button (Visible only when map collapsed) -->
            <Button x:Name="btnRestoreMap"
                    Grid.Row="1"
                    VerticalAlignment="Top" HorizontalAlignment="Right"
                    Margin="0,10,30,0"
                    Content="Show Map â–²"
                    Style="{StaticResource ActionButtonStyle}"
                    Background="{StaticResource AccentColor}"
                    Foreground="#1E1E2E"
                    Click="btnRestoreMap_Click"
                    Visibility="Collapsed"/>

            <!-- 3. LIVE SHIP LIST -->
            <Grid Grid.Row="2" Margin="0,20,0,0">
                <Grid.RowDefinitions>
                    <RowDefinition Height="Auto"/>
                    <RowDefinition Height="*"/>
                </Grid.RowDefinitions>

                <!-- List Header / Filter -->
                <Grid Grid.Row="0" Margin="0,0,0,15">
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="Auto"/>
                        <ColumnDefinition Width="*"/>
                    </Grid.ColumnDefinitions>
                    
                    <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
                        <TextBlock Text="Live Traffic Stream" FontSize="16" FontWeight="Bold" Foreground="White"/>
                        <Border Background="{StaticResource AccentColor}" CornerRadius="4" Padding="6,2" Margin="10,0,0,0" VerticalAlignment="Center">
                            <TextBlock Text="REALTIME" FontSize="10" FontWeight="Bold" Foreground="#1E1E2E"/>
                        </Border>
                    </StackPanel>

                    <!-- Search Box -->
                    <Border Grid.Column="1" HorizontalAlignment="Right" Width="300" Background="{StaticResource BgCard}" CornerRadius="8" Padding="10,5">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                                <ColumnDefinition Width="Auto"/>
                            </Grid.ColumnDefinitions>
                            <TextBlock Text="ðŸ”" Foreground="{StaticResource TextSecondary}" VerticalAlignment="Center" Margin="0,0,8,0"/>
                            
                            <TextBox x:Name="TxtFilter" 
                                     Grid.Column="1"
                                     Background="Transparent" 
                                     BorderThickness="0" 
                                     Foreground="White"
                                     CaretBrush="White"
                                     FontSize="13"
                                     VerticalAlignment="Center"
                                     TextChanged="TxtFilter_TextChanged"/>
                            
                            <TextBlock x:Name="TxtFilterPlaceholder"
                                     Grid.Column="1"
                                     Text="Search by ship name..."
                                     Foreground="#585B70"
                                     IsHitTestVisible="False"
                                     VerticalAlignment="Center"
                                     Margin="2,0,0,0"/>

                            <Button Grid.Column="2" 
                                    Content="âœ•" 
                                    Background="Transparent" 
                                    Foreground="{StaticResource TextSecondary}"
                                    BorderThickness="0"
                                    Cursor="Hand"
                                    FontSize="10"
                                    Click="BtnClearFilter_Click"/>
                        </Grid>
                    </Border>
                </Grid>

                <!-- ListBox Container -->
                <Border Grid.Row="1" Background="{StaticResource BgCard}" CornerRadius="15" Padding="15">
                    <ListBox x:Name="ShipListBox" 
                             Background="Transparent" 
                             BorderThickness="0"
                             ScrollViewer.HorizontalScrollBarVisibility="Disabled"
                             SelectionChanged="ShipListBox_SelectionChanged"
                             MouseDoubleClick="ShipListBox_MouseDoubleClick">
                        <ListBox.ItemContainerStyle>
                            <Style TargetType="ListBoxItem" BasedOn="{StaticResource ShipListItem}"/>
                        </ListBox.ItemContainerStyle>
                        <ListBox.ItemTemplate>
                            <DataTemplate>
                                <Grid>
                                    <Grid.ColumnDefinitions>
                                        <ColumnDefinition Width="50"/> <!-- Icon -->
                                        <ColumnDefinition Width="2*"/> <!-- Name/MMSI -->
                                        <ColumnDefinition Width="1*"/> <!-- Speed -->
                                        <ColumnDefinition Width="1*"/> <!-- Time -->
                                        <ColumnDefinition Width="50"/> <!-- Action -->
                                    </Grid.ColumnDefinitions>

                                    <Border Grid.Column="0" Width="35" Height="35" CornerRadius="8" Background="#313244" HorizontalAlignment="Left">
                                        <TextBlock Text="ðŸš¢" HorizontalAlignment="Center" VerticalAlignment="Center" FontSize="16"/>
                                    </Border>

                                    <StackPanel Grid.Column="1" VerticalAlignment="Center" Margin="10,0,0,0">
                                        <TextBlock Text="{Binding ShipName}" FontSize="14" FontWeight="Bold" Foreground="White"/>
                                        <StackPanel Orientation="Horizontal">
                                            <TextBlock Text="MMSI: " FontSize="11" Foreground="{StaticResource TextSecondary}"/>
                                            <TextBlock Text="{Binding Mmsi}" FontSize="11" Foreground="{StaticResource AccentColor}"/>
                                        </StackPanel>
                                    </StackPanel>

                                    <StackPanel Grid.Column="2" VerticalAlignment="Center" Orientation="Horizontal">
                                        <TextBlock Text="ðŸš€ " FontSize="12"/>
                                        <TextBlock Text="{Binding Speed, StringFormat={}{0:F1} kn}" FontSize="13" Foreground="{StaticResource WarningColor}" FontWeight="SemiBold"/>
                                    </StackPanel>

                                    <TextBlock Grid.Column="3" Text="{Binding LastUpdate, StringFormat=HH:mm:ss}" VerticalAlignment="Center" Foreground="{StaticResource TextSecondary}" FontSize="12"/>

                                    <Button Grid.Column="4" 
                                            Content="â„¹ï¸" 
                                            Style="{StaticResource ActionButtonStyle}" 
                                            Padding="0" Width="30" Height="30"
                                            Background="Transparent"
                                            Click="BtnShipDetails_Click"
                                            Tag="{Binding}"/>
                                </Grid>
                            </DataTemplate>
                        </ListBox.ItemTemplate>
                    </ListBox>
                </Border>
            </Grid>
        </Grid>
    </Grid>
</Window>